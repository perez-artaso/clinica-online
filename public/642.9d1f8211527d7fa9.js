"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[642],{642:(_,g,m)=>{m.r(g),m.d(g,{ClinicalRecordModule:()=>V});var h=m(6895),o=m(433),u=m(2435),p=m(590),e=m(4650),a=m(3422),s=m(349),f=m(2963),v=m(7556);let C=(()=>{class i{constructor(t){this.dateService=t}transform(t){let r="";return r=isNaN(Number(t))?t:this.dateService.getLocaleDateStringByTimestamp(t),r}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.R,16))},i.\u0275pipe=e.Yjl({name:"toLocaleDate",type:i,pure:!0}),i})(),b=(()=>{class i{constructor(t){this.dateService=t}transform(t){let r="";return r=isNaN(Number(t))?t:this.dateService.getLocaleTimeStringByTimestamp(t),r}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.R,16))},i.\u0275pipe=e.Yjl({name:"toLocaleTime",type:i,pure:!0}),i})();function T(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La altura no puede ser inferior a 1 cm"),e.qZA())}function Z(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La altura no puede ser superior a 300 cm"),e.qZA())}function x(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La altura es requerida"),e.qZA())}function y(i,n){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,T,2,0,"small",22),e.YNc(2,Z,2,0,"small",22),e.YNc(3,x,2,0,"small",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.crForm.controls.height.hasError("min")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.height.hasError("max")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.height.hasError("required"))}}function F(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"El peso no puede ser inferior a 1 kg"),e.qZA())}function A(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"El peso no puede ser superior a 300 kg"),e.qZA())}function S(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"El peso es requerido"),e.qZA())}function P(i,n){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,F,2,0,"small",22),e.YNc(2,A,2,0,"small",22),e.YNc(3,S,2,0,"small",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.crForm.controls.weight.hasError("min")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.weight.hasError("max")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.weight.hasError("required"))}}function I(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La temperatura no puede ser inferior a 1 C\xb0"),e.qZA())}function w(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La temperatura no puede ser superior a 100 C\xb0"),e.qZA())}function U(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La temperatura es requerida"),e.qZA())}function N(i,n){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,I,2,0,"small",22),e.YNc(2,w,2,0,"small",22),e.YNc(3,U,2,0,"small",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.crForm.controls.temperature.hasError("min")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.temperature.hasError("max")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.temperature.hasError("required"))}}function q(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"Error de formato. Se espera: ps/pd (Ej, 10/6)"),e.qZA())}function D(i,n){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La presi\xf3n es requerida"),e.qZA())}function k(i,n){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,q,2,0,"small",22),e.YNc(2,D,2,0,"small",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.crForm.controls.bloodPressure.hasError("pattern")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.bloodPressure.hasError("required"))}}function R(i,n){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.ALo(3,"toLocaleDate"),e.ALo(4,"toLocaleTime"),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.hij(" ",e.lcZ(3,2,t.timestamp)+" "+e.lcZ(4,4,t.timestamp)," "),e.xp6(4),e.hij(" ",t.speciality," ")}}function L(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",25)(1,"div",26)(2,"label"),e._uU(3,"Dato a guardar"),e.qZA(),e.TgZ(4,"input",27),e.NdJ("ngModelChange",function(c){e.CHM(t);const l=e.oxw().index,d=e.oxw();return e.KtG(d.dynamicFields[l].key=c)}),e.qZA()(),e.TgZ(5,"div",26)(6,"label"),e._uU(7,"Valor"),e.qZA(),e.TgZ(8,"input",27),e.NdJ("ngModelChange",function(c){e.CHM(t);const l=e.oxw().index,d=e.oxw();return e.KtG(d.dynamicFields[l].value=c)}),e.qZA()()()}if(2&i){const t=e.oxw().index,r=e.oxw();e.xp6(4),e.Q6J("ngModel",r.dynamicFields[t].key)("disabled",r.isPatient),e.xp6(4),e.Q6J("ngModel",r.dynamicFields[t].value)("disabled",r.isPatient)}}function E(i,n){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,L,9,4,"div",24),e.qZA()),2&i){const t=n.index,r=e.oxw();e.xp6(1),e.Q6J("ngIf",t<r.dynamicFieldsAdded)}}function M(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const c=e.oxw();return e.KtG(c.dynamicFieldsAdded=c.dynamicFieldsAdded+1)}),e._UZ(1,"i",29),e._uU(2," Nuevo Campo "),e.qZA()}}function Y(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const c=e.oxw();return e.KtG(c.onSubmitRequest())}),e._uU(1,"Guardar Historia Cl\xednica"),e.qZA()}}function J(i,n){1&i&&(e.TgZ(0,"div",31),e._UZ(1,"i",32),e._uU(2," La historia cl\xednica se guard\xf3 correctamente "),e.qZA())}function O(i,n){1&i&&(e.TgZ(0,"div",33),e._UZ(1,"i",34),e._uU(2," Ha ocurrido un error "),e.qZA())}let B=(()=>{class i{constructor(t,r,c,l,d){this.clinicalRecordService=t,this.appointmentService=r,this.dateService=c,this.activatedRoute=l,this.auth=d,this.maxDynamicFieldsAllowed=3,this.dynamicFieldsAdded=0,this.dynamicFields=[],this.crForm=new o.cw({height:new o.NI(0,o.kI.compose([o.kI.required,o.kI.min(1),o.kI.max(300)])),weight:new o.NI(0,o.kI.compose([o.kI.required,o.kI.min(1),o.kI.max(300)])),temperature:new o.NI(0,o.kI.compose([o.kI.required,o.kI.min(1),o.kI.max(100)])),bloodPressure:new o.NI("",o.kI.compose([o.kI.required,o.kI.pattern(/^[0-9]{1,2}\/[0-9]{1,2}$/)]))}),this.uid="",this.clinicalRecord={id:"",uid:this.uid,height:0,weight:0,temperature:0,bloodPressure:""},this.appointments=[],this.newClinicalRecord=!0,this.succesfulUpdate=!1,this.errorOnUpdate=!1,this.isPatient=!1}ngOnInit(){this.activatedRoute.queryParams.subscribe(t=>{if(t.uid)this.uid=t.uid;else{let r=this.auth.GetCurrentUserID();r&&(this.uid=r)}}),0==this.auth.GetCurrentUserProfile().role&&(this.isPatient=!0,this.disableInputs()),this.initDynamicFields(),this.clinicalRecordService.getClinicalRecordsByUid(this.uid).subscribe(t=>{t.length>0&&(this.clinicalRecord=t[0],this.newClinicalRecord=!1,this.setClinicalRecordFields())}),this.appointmentService.getAppointmentsByPatientId(this.uid).pipe((0,p.P)()).subscribe(t=>{t.forEach(r=>{4==r.status&&!this.appointments.includes(r)&&this.appointments.push(r)})})}onSubmitRequest(){if(this.crForm.valid){for(let t=0;t<this.maxDynamicFieldsAllowed;t++)""!=this.dynamicFields[t].key&&(this.clinicalRecord[this.dynamicFields[t].key]=this.dynamicFields[t].value);this.clinicalRecord.height=Number(this.crForm.controls.height.value),this.clinicalRecord.weight=Number(this.crForm.controls.weight.value),this.clinicalRecord.temperature=Number(this.crForm.controls.temperature.value),this.clinicalRecord.bloodPressure=this.crForm.controls.bloodPressure.value?this.crForm.controls.bloodPressure.value:"",this.submit()}else this.crForm.markAllAsTouched()}disableInputs(){this.crForm.controls.height.disable(),this.crForm.controls.weight.disable(),this.crForm.controls.temperature.disable(),this.crForm.controls.bloodPressure.disable()}submit(){this.newClinicalRecord?this.clinicalRecordService.addDocument(this.clinicalRecord).then(()=>this.onSuccess()).catch(()=>this.onError()):this.clinicalRecordService.updateDocument(this.clinicalRecord.id,this.clinicalRecord).then(()=>this.onSuccess()).catch(()=>this.onError())}onSuccess(){this.succesfulUpdate=!0,setTimeout(()=>this.succesfulUpdate=!1,2500)}onError(){this.errorOnUpdate=!0,setTimeout(()=>this.errorOnUpdate=!1,2500)}initDynamicFields(){for(let t=0;t<this.maxDynamicFieldsAllowed;t++)this.dynamicFields[t]={key:"",value:""}}setClinicalRecordFields(){this.crForm.controls.height.setValue(this.clinicalRecord.height),this.crForm.controls.weight.setValue(this.clinicalRecord.weight),this.crForm.controls.temperature.setValue(this.clinicalRecord.temperature),this.crForm.controls.bloodPressure.setValue(this.clinicalRecord.bloodPressure);let t,r=0;for(t in this.clinicalRecord)"height"!=t&&"weight"!=t&&"temperature"!=t&&"bloodPressure"!=t&&"id"!=t&&"uid"!=t&&(this.dynamicFields[r]={key:t,value:this.clinicalRecord[t]},r++,this.dynamicFieldsAdded++)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.c),e.Y36(s.H),e.Y36(f.R),e.Y36(u.gz),e.Y36(v.e))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-cr-state"]],decls:49,vars:11,consts:[[1,"container","pt-5"],[1,"row"],[1,"col-6"],[1,"row",3,"formGroup"],[1,"col-lg-6"],[1,"form-group"],["for","height"],["formControlName","height","type","number","id","height",1,"form-control"],[4,"ngIf"],["for","weight"],["formControlName","weight","type","number","id","weight",1,"form-control"],["for","temperature"],["formControlName","temperature","type","number","id","temperature",1,"form-control"],["for","bloodPressure"],["formControlName","bloodPressure","type","text","id","bloodPressure",1,"form-control"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["id","new-field-btn",3,"click",4,"ngIf"],["id","submit-cr-btn",3,"click",4,"ngIf"],[2,"text-align","center"],["class","alert alert-success feedback-message",4,"ngIf"],["class","alert alert-danger feedback-message",4,"ngIf"],["class","error-msg",4,"ngIf"],[1,"error-msg"],["class","row mb-3",4,"ngIf"],[1,"row","mb-3"],[1,"form-group","col-3"],["type","text",1,"form-control",3,"ngModel","disabled","ngModelChange"],["id","new-field-btn",3,"click"],[1,"bi","bi-plus-square"],["id","submit-cr-btn",3,"click"],[1,"alert","alert-success","feedback-message"],[1,"bi","bi-check-circle-fill"],[1,"alert","alert-danger","feedback-message"],[1,"bi","bi-x-circle-fill"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"h1"),e._uU(2,"Historia Cl\xednica"),e.qZA(),e.TgZ(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"label",6),e._uU(9," Altura (cm) "),e.qZA(),e._UZ(10,"input",7),e.YNc(11,y,4,3,"div",8),e.qZA()(),e.TgZ(12,"div",4)(13,"div",5)(14,"label",9),e._uU(15," Peso (kg) "),e.qZA(),e._UZ(16,"input",10),e.YNc(17,P,4,3,"div",8),e.qZA()(),e.TgZ(18,"div",4)(19,"div",5)(20,"label",11),e._uU(21," Temperatura (c\xb0) "),e.qZA(),e._UZ(22,"input",12),e.YNc(23,N,4,3,"div",8),e.qZA()(),e.TgZ(24,"div",4)(25,"div",5)(26,"label",13),e._uU(27," Presi\xf3n Arterial (sist/diast) "),e.qZA(),e._UZ(28,"input",14),e.YNc(29,k,3,2,"div",8),e.qZA()()()(),e.TgZ(30,"div",2)(31,"h3"),e._uU(32,"Historial de atenciones"),e.qZA(),e.TgZ(33,"table",15)(34,"thead")(35,"th"),e._uU(36," Fecha "),e.qZA(),e.TgZ(37,"th"),e._uU(38," Especialidad "),e.qZA()(),e.TgZ(39,"tbody"),e.YNc(40,R,7,6,"tr",16),e.qZA()()()(),e.TgZ(41,"h2"),e._uU(42," Otros Campos "),e.qZA(),e.YNc(43,E,2,1,"div",16),e.YNc(44,M,3,0,"button",17),e.YNc(45,Y,2,0,"button",18),e.TgZ(46,"div",19),e.YNc(47,J,3,0,"div",20),e.YNc(48,O,3,0,"div",21),e.qZA()()),2&t&&(e.xp6(5),e.Q6J("formGroup",r.crForm),e.xp6(6),e.Q6J("ngIf",r.crForm.controls.height.touched),e.xp6(6),e.Q6J("ngIf",r.crForm.controls.weight.touched),e.xp6(6),e.Q6J("ngIf",r.crForm.controls.temperature.touched),e.xp6(6),e.Q6J("ngIf",r.crForm.controls.bloodPressure.touched),e.xp6(11),e.Q6J("ngForOf",r.appointments),e.xp6(3),e.Q6J("ngForOf",r.dynamicFields),e.xp6(1),e.Q6J("ngIf",r.dynamicFieldsAdded<r.maxDynamicFieldsAllowed&&!r.isPatient),e.xp6(1),e.Q6J("ngIf",!r.isPatient),e.xp6(2),e.Q6J("ngIf",r.succesfulUpdate),e.xp6(1),e.Q6J("ngIf",r.errorOnUpdate))},dependencies:[h.sg,h.O5,o.Fj,o.wV,o.JJ,o.JL,o.sg,o.u,o.On,C,b],styles:["h1[_ngcontent-%COMP%]{margin-bottom:2rem}h2[_ngcontent-%COMP%]{margin:2rem 0rem}#new-field-btn[_ngcontent-%COMP%]{border-radius:.5rem;background-color:var(--light);color:#fff;font-size:large;margin-top:1rem}#new-field-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}#submit-cr-btn[_ngcontent-%COMP%]{border-radius:.5rem;background-color:var(--dark);color:#fff;font-size:large;display:block;margin:3rem 0;font-size:x-large;padding:.5rem}#submit-cr-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}.error-msg[_ngcontent-%COMP%]{color:#ee5d5d}.feedback-message[_ngcontent-%COMP%]{max-width:40%;margin:0 auto;font-size:x-large}table[_ngcontent-%COMP%]{width:50%}h3[_ngcontent-%COMP%]{margin-bottom:1rem}"]}),i})();var Q=m(9181);function H(i,n){if(1&i&&(e.TgZ(0,"div",9),e._uU(1),e.qZA()),2&i){const t=n.$implicit,r=e.oxw(2);e.xp6(1),e.hij(" ",r.dateService.getLocaleDateStringByTimestamp(t.timestamp)+" "+r.dateService.getLocaleTimeStringByTimestamp(t.timestamp)+" - "+t.speciality," ")}}function G(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",3),e.NdJ("click",function(){const l=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.navigateToCr(l.uid))}),e.TgZ(1,"div",4)(2,"h5",5),e._uU(3),e.qZA(),e.TgZ(4,"h6",6),e._uU(5),e.qZA(),e.TgZ(6,"h6",6),e._uU(7),e.qZA(),e.TgZ(8,"strong"),e._uU(9,"\xdaltimas Atenciones"),e.qZA(),e.TgZ(10,"div",7),e.YNc(11,H,2,1,"div",8),e.qZA()()()}if(2&i){const t=n.$implicit,r=e.oxw();e.xp6(3),e.Oqu(t.name+" "+t.last_name),e.xp6(2),e.hij("Edad: ",t.age,""),e.xp6(2),e.hij("Email: ",t.user_email,""),e.xp6(4),e.Q6J("ngForOf",r.getLastAppointmentsByPatientId(t.uid,3))}}const j=[{path:"",children:[{path:"state",component:B},{path:"list",component:(()=>{class i{constructor(t,r,c,l,d){this.appointmentService=t,this.profileService=r,this.auth=c,this.router=l,this.dateService=d,this.myPatients=[],this.myAppointments=[]}ngOnInit(){const t=this.auth.GetCurrentUserID();1==this.auth.GetCurrentUserProfile().role?t&&this.appointmentService.getAppointmentsBySpecialistId(t).subscribe(r=>{let c=[];this.myAppointments=r,this.myAppointments.sort((l,d)=>Number(d.timestamp)-Number(l.timestamp)),r.forEach(l=>{4==l.status&&!c.includes(l.idPatient)&&c.push(l.idPatient)}),c.forEach(l=>{this.profileService.getProfileByUID(l).pipe((0,p.P)()).subscribe(d=>{this.myPatients.push(d[0])})})}):this.appointmentService.getDocuments().subscribe(r=>{let c=[];r.forEach(l=>{4==l.status&&!c.includes(l.idPatient)&&c.push(l.idPatient)}),c.forEach(l=>{this.profileService.getProfileByUID(l).pipe((0,p.P)()).subscribe(d=>{this.myPatients.push(d[0])})})})}getLastAppointmentsByPatientId(t,r){let c=[],l=0;for(let d=0;d<this.myAppointments.length&&l<r;d++)4==this.myAppointments[d].status&&this.myAppointments[d].idPatient==t&&(c.push(this.myAppointments[d]),l++);return c}navigateToCr(t){this.router.navigate(["/clinical-record/state"],{queryParams:{uid:t},replaceUrl:!0})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(s.H),e.Y36(Q.H),e.Y36(v.e),e.Y36(u.F0),e.Y36(f.R))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-list-crs"]],decls:3,vars:1,consts:[[1,"container","pt-5"],[1,"row"],["class","card col-4 ms-3",3,"click",4,"ngFor","ngForOf"],[1,"card","col-4","ms-3",3,"click"],[1,"card-body"],[1,"card-title"],[1,"card-subtitle","mb-2","text-muted"],[2,"padding",".5rem","margin-top",".5rem"],["class","card-text",4,"ngFor","ngForOf"],[1,"card-text"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,G,12,4,"div",2),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngForOf",r.myPatients))},dependencies:[h.sg],styles:["i[_ngcontent-%COMP%]:hover, .card[_ngcontent-%COMP%]:hover{cursor:pointer}.card[_ngcontent-%COMP%]:active{transform:scale(.95)}"]}),i})()}]}];let z=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[u.Bz.forChild(j),u.Bz]}),i})(),V=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.ez,z,o.UX,o.u5]}),i})()},349:(_,g,m)=>{m.d(g,{H:()=>u});var h=m(4650),o=m(7407);let u=(()=>{class p{constructor(a){this.firestore=a,this.collectionPath="/appointments",this.apponintmentsCollection=a.collection(this.collectionPath)}getDocuments(){return this.apponintmentsCollection.valueChanges({idField:"id"})}addDocument(a){return this.apponintmentsCollection.add(a)}updateDocument(a,s){return this.apponintmentsCollection.doc(a).update(s)}deleteDocument(a){return this.apponintmentsCollection.doc(a).delete()}getAppointmentsBySpecialistId(a){return this.firestore.collection(this.collectionPath,s=>s.where("idSpecialist","==",a)).valueChanges({idField:"id"})}getAppointmentsByPatientId(a){return this.firestore.collection(this.collectionPath,s=>s.where("idPatient","==",a)).valueChanges({idField:"id"})}getAppointmentsByStatus(a){return this.firestore.collection(this.collectionPath,s=>s.where("status","==",a)).valueChanges({idField:"id"})}}return p.\u0275fac=function(a){return new(a||p)(h.LFG(o.ST))},p.\u0275prov=h.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},2963:(_,g,m)=>{m.d(g,{R:()=>o});var h=m(4650);let o=(()=>{class u{constructor(){}getInvertedLocaleDateStringByTimestamp(e){let a=new Date(Number(e)).toLocaleDateString(),s=a.split("/");return 1==s[1].length&&(s[1]="0"+s[1]),1==s[0].length&&(s[0]="0"+s[0]),3==s.length?s[2]+"-"+s[1]+"-"+s[0]:a}getLocaleDateStringByTimestamp(e){return new Date(Number(e)).toLocaleDateString()}getLocaleTimeStringByTimestamp(e){const a=new Date(Number(e));return a.getHours().toString()+":"+(1==a.getMinutes().toString().length?"0"+a.getMinutes().toString():a.getMinutes().toString())}getDayOfTheWeekNameByTimestamp(e){let s="";switch(new Date(Number(e)).getDay()){case 1:s="Lunes";break;case 2:s="Martes";break;case 3:s="Mi\xe9rcoles";break;case 4:s="Jueves";break;case 5:s="Viernes";break;case 6:s="S\xe1bado";break;case 0:s="Domingo"}return s}}return u.\u0275fac=function(e){return new(e||u)},u.\u0275prov=h.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);