"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[870],{7870:(G,p,a)=>{a.r(p),a.d(p,{ClinicalRecordModule:()=>H});var d=a(6895),n=a(433),m=a(9051),u=a(590),e=a(4650),f=a(3422),h=a(349),_=a(2963),g=a(7556);function C(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La altura no puede ser inferior a 1 cm"),e.qZA())}function v(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La altura no puede ser superior a 300 cm"),e.qZA())}function Z(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La altura es requerida"),e.qZA())}function b(i,o){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,C,2,0,"small",22),e.YNc(2,v,2,0,"small",22),e.YNc(3,Z,2,0,"small",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.crForm.controls.height.hasError("min")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.height.hasError("max")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.height.hasError("required"))}}function x(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"El peso no puede ser inferior a 1 kg"),e.qZA())}function T(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"El peso no puede ser superior a 300 kg"),e.qZA())}function F(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"El peso es requerido"),e.qZA())}function A(i,o){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,x,2,0,"small",22),e.YNc(2,T,2,0,"small",22),e.YNc(3,F,2,0,"small",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.crForm.controls.weight.hasError("min")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.weight.hasError("max")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.weight.hasError("required"))}}function y(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La temperatura no puede ser inferior a 1 C\xb0"),e.qZA())}function I(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La temperatura no puede ser superior a 100 C\xb0"),e.qZA())}function U(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La temperatura es requerida"),e.qZA())}function q(i,o){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,y,2,0,"small",22),e.YNc(2,I,2,0,"small",22),e.YNc(3,U,2,0,"small",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.crForm.controls.temperature.hasError("min")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.temperature.hasError("max")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.temperature.hasError("required"))}}function S(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"Error de formato. Se espera: ps/pd (Ej, 10/6)"),e.qZA())}function P(i,o){1&i&&(e.TgZ(0,"small",23),e._uU(1,"La presi\xf3n es requerida"),e.qZA())}function w(i,o){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,S,2,0,"small",22),e.YNc(2,P,2,0,"small",22),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.crForm.controls.bloodPressure.hasError("pattern")),e.xp6(1),e.Q6J("ngIf",t.crForm.controls.bloodPressure.hasError("required"))}}function N(i,o){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA()()),2&i){const t=o.$implicit,r=e.oxw();e.xp6(2),e.hij(" ",r.dateService.getLocaleDateStringByTimestamp(t.timestamp)+" "+r.dateService.getLocaleTimeStringByTimestamp(t.timestamp)," "),e.xp6(2),e.hij(" ",t.speciality," ")}}function R(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",25)(1,"div",26)(2,"label"),e._uU(3,"Dato a guardar"),e.qZA(),e.TgZ(4,"input",27),e.NdJ("ngModelChange",function(s){e.CHM(t);const c=e.oxw().index,l=e.oxw();return e.KtG(l.dynamicFields[c].key=s)}),e.qZA()(),e.TgZ(5,"div",26)(6,"label"),e._uU(7,"Valor"),e.qZA(),e.TgZ(8,"input",27),e.NdJ("ngModelChange",function(s){e.CHM(t);const c=e.oxw().index,l=e.oxw();return e.KtG(l.dynamicFields[c].value=s)}),e.qZA()()()}if(2&i){const t=e.oxw().index,r=e.oxw();e.xp6(4),e.Q6J("ngModel",r.dynamicFields[t].key)("disabled",r.isPatient),e.xp6(4),e.Q6J("ngModel",r.dynamicFields[t].value)("disabled",r.isPatient)}}function k(i,o){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,R,9,4,"div",24),e.qZA()),2&i){const t=o.index,r=e.oxw();e.xp6(1),e.Q6J("ngIf",t<r.dynamicFieldsAdded)}}function J(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.dynamicFieldsAdded=s.dynamicFieldsAdded+1)}),e._UZ(1,"i",29),e._uU(2," Nuevo Campo "),e.qZA()}}function E(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onSubmitRequest())}),e._uU(1,"Guardar Historia Cl\xednica"),e.qZA()}}function Y(i,o){1&i&&(e.TgZ(0,"div",31),e._UZ(1,"i",32),e._uU(2," La historia cl\xednica se guard\xf3 correctamente "),e.qZA())}function M(i,o){1&i&&(e.TgZ(0,"div",33),e._UZ(1,"i",34),e._uU(2," Ha ocurrido un error "),e.qZA())}let Q=(()=>{class i{constructor(t,r,s,c,l){this.clinicalRecordService=t,this.appointmentService=r,this.dateService=s,this.activatedRoute=c,this.auth=l,this.maxDynamicFieldsAllowed=3,this.dynamicFieldsAdded=0,this.dynamicFields=[],this.crForm=new n.cw({height:new n.NI(0,n.kI.compose([n.kI.required,n.kI.min(1),n.kI.max(300)])),weight:new n.NI(0,n.kI.compose([n.kI.required,n.kI.min(1),n.kI.max(300)])),temperature:new n.NI(0,n.kI.compose([n.kI.required,n.kI.min(1),n.kI.max(100)])),bloodPressure:new n.NI("",n.kI.compose([n.kI.required,n.kI.pattern(/^[0-9]{1,2}\/[0-9]{1,2}$/)]))}),this.uid="",this.clinicalRecord={id:"",uid:this.uid,height:0,weight:0,temperature:0,bloodPressure:""},this.appointments=[],this.newClinicalRecord=!0,this.succesfulUpdate=!1,this.errorOnUpdate=!1,this.isPatient=!1}ngOnInit(){this.activatedRoute.queryParams.subscribe(t=>{if(t.uid)this.uid=t.uid;else{let r=this.auth.GetCurrentUserID();r&&(this.uid=r)}}),0==this.auth.GetCurrentUserProfile().role&&(this.isPatient=!0,this.disableInputs()),this.initDynamicFields(),this.clinicalRecordService.getClinicalRecordsByUid(this.uid).subscribe(t=>{t.length>0&&(this.clinicalRecord=t[0],this.newClinicalRecord=!1,this.setClinicalRecordFields())}),this.appointmentService.getAppointmentsByPatientId(this.uid).pipe((0,u.P)()).subscribe(t=>{t.forEach(r=>{4==r.status&&!this.appointments.includes(r)&&this.appointments.push(r)})})}onSubmitRequest(){if(this.crForm.valid){for(let t=0;t<this.maxDynamicFieldsAllowed;t++)""!=this.dynamicFields[t].key&&(this.clinicalRecord[this.dynamicFields[t].key]=this.dynamicFields[t].value);this.clinicalRecord.height=Number(this.crForm.controls.height.value),this.clinicalRecord.weight=Number(this.crForm.controls.weight.value),this.clinicalRecord.temperature=Number(this.crForm.controls.temperature.value),this.clinicalRecord.bloodPressure=this.crForm.controls.bloodPressure.value?this.crForm.controls.bloodPressure.value:"",this.submit()}else this.crForm.markAllAsTouched()}disableInputs(){this.crForm.controls.height.disable(),this.crForm.controls.weight.disable(),this.crForm.controls.temperature.disable(),this.crForm.controls.bloodPressure.disable()}submit(){this.newClinicalRecord?this.clinicalRecordService.addDocument(this.clinicalRecord).then(()=>this.onSuccess()).catch(()=>this.onError()):this.clinicalRecordService.updateDocument(this.clinicalRecord.id,this.clinicalRecord).then(()=>this.onSuccess()).catch(()=>this.onError())}onSuccess(){this.succesfulUpdate=!0,setTimeout(()=>this.succesfulUpdate=!1,2500)}onError(){this.errorOnUpdate=!0,setTimeout(()=>this.errorOnUpdate=!1,2500)}initDynamicFields(){for(let t=0;t<this.maxDynamicFieldsAllowed;t++)this.dynamicFields[t]={key:"",value:""}}setClinicalRecordFields(){this.crForm.controls.height.setValue(this.clinicalRecord.height),this.crForm.controls.weight.setValue(this.clinicalRecord.weight),this.crForm.controls.temperature.setValue(this.clinicalRecord.temperature),this.crForm.controls.bloodPressure.setValue(this.clinicalRecord.bloodPressure);let t,r=0;for(t in this.clinicalRecord)"height"!=t&&"weight"!=t&&"temperature"!=t&&"bloodPressure"!=t&&"id"!=t&&"uid"!=t&&(this.dynamicFields[r]={key:t,value:this.clinicalRecord[t]},r++,this.dynamicFieldsAdded++)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.c),e.Y36(h.H),e.Y36(_.R),e.Y36(m.gz),e.Y36(g.e))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-cr-state"]],decls:49,vars:11,consts:[[1,"container","pt-5"],[1,"row"],[1,"col-6"],[1,"row",3,"formGroup"],[1,"col-lg-6"],[1,"form-group"],["for","height"],["formControlName","height","type","number","id","height",1,"form-control"],[4,"ngIf"],["for","weight"],["formControlName","weight","type","number","id","weight",1,"form-control"],["for","temperature"],["formControlName","temperature","type","number","id","temperature",1,"form-control"],["for","bloodPressure"],["formControlName","bloodPressure","type","text","id","bloodPressure",1,"form-control"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["id","new-field-btn",3,"click",4,"ngIf"],["id","submit-cr-btn",3,"click",4,"ngIf"],[2,"text-align","center"],["class","alert alert-success feedback-message",4,"ngIf"],["class","alert alert-danger feedback-message",4,"ngIf"],["class","error-msg",4,"ngIf"],[1,"error-msg"],["class","row mb-3",4,"ngIf"],[1,"row","mb-3"],[1,"form-group","col-3"],["type","text",1,"form-control",3,"ngModel","disabled","ngModelChange"],["id","new-field-btn",3,"click"],[1,"bi","bi-plus-square"],["id","submit-cr-btn",3,"click"],[1,"alert","alert-success","feedback-message"],[1,"bi","bi-check-circle-fill"],[1,"alert","alert-danger","feedback-message"],[1,"bi","bi-x-circle-fill"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"h1"),e._uU(2,"Historia Cl\xednica"),e.qZA(),e.TgZ(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"label",6),e._uU(9," Altura (cm) "),e.qZA(),e._UZ(10,"input",7),e.YNc(11,b,4,3,"div",8),e.qZA()(),e.TgZ(12,"div",4)(13,"div",5)(14,"label",9),e._uU(15," Peso (kg) "),e.qZA(),e._UZ(16,"input",10),e.YNc(17,A,4,3,"div",8),e.qZA()(),e.TgZ(18,"div",4)(19,"div",5)(20,"label",11),e._uU(21," Temperatura (c\xb0) "),e.qZA(),e._UZ(22,"input",12),e.YNc(23,q,4,3,"div",8),e.qZA()(),e.TgZ(24,"div",4)(25,"div",5)(26,"label",13),e._uU(27," Presi\xf3n Arterial (sist/diast) "),e.qZA(),e._UZ(28,"input",14),e.YNc(29,w,3,2,"div",8),e.qZA()()()(),e.TgZ(30,"div",2)(31,"h3"),e._uU(32,"Historial de atenciones"),e.qZA(),e.TgZ(33,"table",15)(34,"thead")(35,"th"),e._uU(36," Fecha "),e.qZA(),e.TgZ(37,"th"),e._uU(38," Especialidad "),e.qZA()(),e.TgZ(39,"tbody"),e.YNc(40,N,5,2,"tr",16),e.qZA()()()(),e.TgZ(41,"h2"),e._uU(42," Otros Campos "),e.qZA(),e.YNc(43,k,2,1,"div",16),e.YNc(44,J,3,0,"button",17),e.YNc(45,E,2,0,"button",18),e.TgZ(46,"div",19),e.YNc(47,Y,3,0,"div",20),e.YNc(48,M,3,0,"div",21),e.qZA()()),2&t&&(e.xp6(5),e.Q6J("formGroup",r.crForm),e.xp6(6),e.Q6J("ngIf",r.crForm.controls.height.touched),e.xp6(6),e.Q6J("ngIf",r.crForm.controls.weight.touched),e.xp6(6),e.Q6J("ngIf",r.crForm.controls.temperature.touched),e.xp6(6),e.Q6J("ngIf",r.crForm.controls.bloodPressure.touched),e.xp6(11),e.Q6J("ngForOf",r.appointments),e.xp6(3),e.Q6J("ngForOf",r.dynamicFields),e.xp6(1),e.Q6J("ngIf",r.dynamicFieldsAdded<r.maxDynamicFieldsAllowed&&!r.isPatient),e.xp6(1),e.Q6J("ngIf",!r.isPatient),e.xp6(2),e.Q6J("ngIf",r.succesfulUpdate),e.xp6(1),e.Q6J("ngIf",r.errorOnUpdate))},dependencies:[d.sg,d.O5,n.Fj,n.wV,n.JJ,n.JL,n.sg,n.u,n.On],styles:["h1[_ngcontent-%COMP%]{margin-bottom:2rem}h2[_ngcontent-%COMP%]{margin:2rem 0rem}#new-field-btn[_ngcontent-%COMP%]{border-radius:.5rem;background-color:var(--light);color:#fff;font-size:large;margin-top:1rem}#new-field-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}#submit-cr-btn[_ngcontent-%COMP%]{border-radius:.5rem;background-color:var(--dark);color:#fff;font-size:large;display:block;margin:3rem 0;font-size:x-large;padding:.5rem}#submit-cr-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}.error-msg[_ngcontent-%COMP%]{color:#ee5d5d}.feedback-message[_ngcontent-%COMP%]{max-width:40%;margin:0 auto;font-size:x-large}table[_ngcontent-%COMP%]{width:50%}h3[_ngcontent-%COMP%]{margin-bottom:1rem}"]}),i})();var O=a(9181);function D(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td")(8,"i",3),e.NdJ("click",function(){const c=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.navigateToCr(c.uid))}),e.qZA()()()}if(2&i){const t=o.$implicit;e.xp6(2),e.hij(" ",t.name+" "+t.last_name," "),e.xp6(2),e.hij(" ",t.age," "),e.xp6(2),e.hij(" ",t.user_email," ")}}const L=[{path:"",children:[{path:"state",component:Q},{path:"list",component:(()=>{class i{constructor(t,r,s,c){this.appointmentService=t,this.profileService=r,this.auth=s,this.router=c,this.myPatients=[]}ngOnInit(){const t=this.auth.GetCurrentUserID();1==this.auth.GetCurrentUserProfile().role?t&&this.appointmentService.getAppointmentsBySpecialistId(t).subscribe(r=>{let s=[];r.forEach(c=>{4==c.status&&!s.includes(c.idPatient)&&s.push(c.idPatient)}),s.forEach(c=>{this.profileService.getProfileByUID(c).pipe((0,u.P)()).subscribe(l=>{this.myPatients.push(l[0])})})}):this.appointmentService.getDocuments().subscribe(r=>{let s=[];r.forEach(c=>{4==c.status&&!s.includes(c.idPatient)&&s.push(c.idPatient)}),s.forEach(c=>{this.profileService.getProfileByUID(c).pipe((0,u.P)()).subscribe(l=>{this.myPatients.push(l[0])})})})}navigateToCr(t){this.router.navigate(["/clinical-record/state"],{queryParams:{uid:t},replaceUrl:!0})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.H),e.Y36(O.H),e.Y36(g.e),e.Y36(m.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-list-crs"]],decls:13,vars:1,consts:[[1,"container","pt-5"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"bi","bi-folder2",3,"click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"table",1)(2,"thead")(3,"th"),e._uU(4," Nombre "),e.qZA(),e.TgZ(5,"th"),e._uU(6," Edad "),e.qZA(),e.TgZ(7,"th"),e._uU(8," Contacto "),e.qZA(),e.TgZ(9,"th"),e._uU(10," Historia Cl\xednica "),e.qZA()(),e.TgZ(11,"tbody"),e.YNc(12,D,9,3,"tr",2),e.qZA()()()),2&t&&(e.xp6(12),e.Q6J("ngForOf",r.myPatients))},dependencies:[d.sg],styles:["i[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),i})()}]}];let B=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[m.Bz.forChild(L),m.Bz]}),i})(),H=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[d.ez,B,n.UX,n.u5]}),i})()}}]);