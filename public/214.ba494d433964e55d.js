"use strict";(self.webpackChunkclinica_online=self.webpackChunkclinica_online||[]).push([[214],{3214:(z,C,r)=>{r.r(C),r.d(C,{ReportsModule:()=>M});var h=r(6895),S=r(2435),p=r(433),c=r(4641),y=r(8493),v=r(2340),t=r(4650),A=r(7579),T=r(349),L=r(9181),B=r(1608);let g=(()=>{class n{constructor(e,i,a){this.appointments=e,this.profiles=i,this.loginLogService=a,this._reportsPublisher$=new A.x,this._appointments=[],this._profiles=[],this._loginLogs=[],this.ready=!1,this.initialize()}initialize(){this.appointments.getDocuments().subscribe(e=>{this._appointments=e,this.VerifyIfReady()}),this.profiles.getDocuments().subscribe(e=>{this._profiles=e,this.VerifyIfReady()}),this.loginLogService.getDocuments().subscribe(e=>{this._loginLogs=e,this.VerifyIfReady()})}ReportsSubscription(){return this._reportsPublisher$}ReportsAreReady(){this._reportsPublisher$.next()}VerifyIfReady(){this._appointments.length>0&&this._profiles.length>0&&this._loginLogs.length>0&&(this.ready=!0,this.ReportsAreReady())}GetGroupedAppointmentsByDate(){let e={};for(let i=0;i<this._appointments.length;i++)e[this.GetUnseparatedPlainDateByTimestamp(Number(this._appointments[i].timestamp))]?e[this.GetUnseparatedPlainDateByTimestamp(Number(this._appointments[i].timestamp))]++:e[this.GetUnseparatedPlainDateByTimestamp(Number(this._appointments[i].timestamp))]=1;return e}GetUnseparatedPlainDateByTimestamp(e){return new Date(e).toLocaleDateString()}GetLoginLogs(){return this.loginLogService.getDocuments()}GetAppointmentsBySpecialityAsLabeledData(){let e=[];const i=this.GetAppoimentsBySpeciality();for(let a=0;a<i.length;a++)e.push({label:i[a][0].speciality,data:i[a].length});return e}GetAppoimentsBySpeciality(){let e=this.GetSpecialityNames(),i=[];return e.forEach(a=>{i.push(this.GetAppointmentsBySpecialityName(a))}),i}GetSpecialityNames(){let e=[];return this._appointments.forEach(i=>{e.includes(i.speciality)||e.push(i.speciality)}),e}GetAppointmentsBySpecialityName(e){return this._appointments.filter(i=>i.speciality==e)}GetRequestedAppointmentsBySpecialistInRange(e,i){let a={};return this._appointments.forEach(s=>{Number(s.timestamp)<i&&Number(s.timestamp)>e&&(a[s.idSpecialist]?a[s.idSpecialist].appointments.push(s):(a[s.idSpecialist]={name:"",appointments:[]},a[s.idSpecialist].appointments=[s],a[s.idSpecialist].name=this.GetSpecialistFullNameByUid(s.idSpecialist)))}),a}GetFinalizedAppointmentsBySpecialistInRange(e,i){let a={};return this._appointments.forEach(s=>{4==s.status&&Number(s.timestamp)<i&&Number(s.timestamp)>e&&(a[s.idSpecialist]?a[s.idSpecialist].appointments.push(s):(a[s.idSpecialist]={name:"",appointments:[]},a[s.idSpecialist].appointments=[s],a[s.idSpecialist].name=this.GetSpecialistFullNameByUid(s.idSpecialist)))}),a}GetSpecialistFullNameByUid(e){let i="";return this._profiles.forEach(a=>{a.uid==e&&(i=a.name+" "+a.last_name)}),i}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(T.H),t.LFG(L.H),t.LFG(B.L))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var f=r(4155);function x(n,o){1&n&&(t.TgZ(0,"small",19),t._uU(1," El formato esperado es dd/mm/aaaa "),t.qZA())}function R(n,o){1&n&&(t.TgZ(0,"small",19),t._uU(1," El formato esperado es dd/mm/aaaa "),t.qZA())}const _=function(n){return{"opt-selected":n}};function D(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3),t._UZ(3,"canvas",4,5),t.TgZ(5,"button",6),t.NdJ("click",function(){t.CHM(e);const a=t.MAs(4),s=t.oxw();return t.KtG(s.GetBase64FromCanvas(a))}),t._uU(6,"Descargar"),t.qZA()(),t.TgZ(7,"div",7)(8,"div",8)(9,"div",9)(10,"label"),t._uU(11," Desde "),t.qZA(),t._UZ(12,"input",10),t.YNc(13,x,2,0,"small",11),t.qZA(),t.TgZ(14,"div",9)(15,"label"),t._uU(16," Hasta "),t.qZA(),t._UZ(17,"input",12),t.YNc(18,R,2,0,"small",11),t.qZA(),t.TgZ(19,"div",13)(20,"div",14)(21,"button",15),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.finalizedSelected=!1)}),t._uU(22,"Solicitados"),t.qZA()(),t.TgZ(23,"div",14)(24,"button",15),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.finalizedSelected=!0)}),t._uU(25,"Realizados"),t.qZA()()(),t.TgZ(26,"div",16)(27,"div",17)(28,"button",18),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onSubmit())}),t._uU(29,"Buscar"),t.qZA()()()()()()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("type","pie")("datasets",e.pieChartDatasets)("labels",e.pieChartLabels)("options",e.pieChartOptions)("plugins",e.pieChartPlugins)("legend",e.pieChartLegend),t.xp6(5),t.Q6J("formGroup",e.dateForm),t.xp6(5),t.Q6J("ngIf",!e.dateForm.controls.from.valid&&e.dateForm.controls.from.touched),t.xp6(5),t.Q6J("ngIf",!e.dateForm.controls.to.valid&&e.dateForm.controls.to.touched),t.xp6(3),t.Q6J("ngClass",t.VKq(11,_,!e.finalizedSelected)),t.xp6(3),t.Q6J("ngClass",t.VKq(13,_,e.finalizedSelected))}}c.vfs=y.I.vfs;let G=(()=>{class n{constructor(e){this.reportService=e,this.finalizedSelected=!1,this.dateForm=new p.cw({from:new p.NI("",p.kI.compose([p.kI.required,p.kI.pattern(/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/)])),to:new p.NI("",p.kI.compose([p.kI.required,p.kI.pattern(/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/)]))}),this.pieChartOptions={responsive:!1},this.pieChartLabels=[],this.pieChartDatasets=[{data:[]}],this.pieChartLegend=!0,this.pieChartPlugins=[],this.display=!1}ngOnInit(){let e=new Date(2022,1,1),i=new Date(2023,1,1);this.reportService.ReportsSubscription().subscribe(()=>{let s,a=this.reportService.GetRequestedAppointmentsBySpecialistInRange(e.getTime(),i.getTime());for(s in a)this.pieChartLabels.push(a[s].name+": "+a[s].appointments.length),this.pieChartDatasets[0].data.push(a[s].appointments.length);this.display=!0}),this.reportService.ready&&this.reportService.ReportsAreReady()}onSubmit(){if(this.dateForm.valid){let e=this.dateForm.controls.from.value,i=this.dateForm.controls.to.value;if(e&&i){let a=e.split("/"),s=i.split("/"),m=new Date(Number(a[2]),Number(a[1])-1,Number(a[0])),d=new Date(Number(s[2]),Number(s[1])-1,Number(s[0]));this.pieChartLabels=[],this.pieChartDatasets=[{data:[]}];let u,l=this.finalizedSelected?this.reportService.GetFinalizedAppointmentsBySpecialistInRange(m.getTime(),d.getTime()):this.reportService.GetRequestedAppointmentsBySpecialistInRange(m.getTime(),d.getTime());for(u in l)this.pieChartLabels.push(l[u].name+": "+l[u].appointments.length),this.pieChartDatasets[0].data.push(l[u].appointments.length)}}else this.dateForm.markAllAsTouched()}GetBase64FromCanvas(e){const i=e.toDataURL();c.createPdf({content:[{image:"data:image/jpg;base64,"+v.N.clinicLogo,width:200,height:200,alignment:"center"},{text:"Turnos por especialista entre "+this.dateForm.controls.from.value+" y "+this.dateForm.controls.to.value,fontSize:22,bold:!0,alignment:"center"},{image:i,width:400,height:400,alignment:"center",margin:[0,50]}]}).open()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-appointments-by-specialist-in-range"]],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"row"],[1,"col-8"],["baseChart","",2,"width","750px","height","750px",3,"type","datasets","labels","options","plugins","legend"],["canvas",""],[1,"btn","btn-primary",3,"click"],[1,"col-4"],[3,"formGroup"],[1,"form-group"],["formControlName","from","type","text",1,"form-control"],["style","color: rgb(235, 66, 66)",4,"ngIf"],["formControlName","to","type","text",1,"form-control"],[1,"row","d-flex","justify-content-around","mt-4"],[1,"col-6",2,"text-align","center"],[1,"my-opt-btn",3,"ngClass","click"],[1,"row","mt-4"],[1,"col-12",2,"text-align","center"],["id","my-search-button",3,"click"],[2,"color","rgb(235, 66, 66)"]],template:function(e,i){1&e&&t.YNc(0,D,30,15,"div",0),2&e&&t.Q6J("ngIf",i.display)},dependencies:[h.mk,h.O5,f.jh,p.Fj,p.JJ,p.JL,p.sg,p.u],styles:[".my-opt-btn[_ngcontent-%COMP%]{padding:.4rem;color:#fff;background-color:var(--light)}#my-search-button[_ngcontent-%COMP%]{padding:.4rem;color:#fff;background-color:var(--dark)}.opt-selected[_ngcontent-%COMP%]{transform:scale(.9)}"]}),n})();function N(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",1),t._UZ(1,"canvas",2,3),t.TgZ(3,"button",4),t.NdJ("click",function(){t.CHM(e);const a=t.MAs(2),s=t.oxw();return t.KtG(s.GetBase64FromCanvas(a))}),t._uU(4,"Descargar"),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("data",e.barChartData)("options",e.barChartOptions)("plugins",e.barChartPlugins)("legend",e.barChartLegend)("type","bar")}}c.vfs=y.I.vfs;let F=(()=>{class n{constructor(e){this.reportService=e,this.barChartLegend=!0,this.barChartPlugins=[],this.barChartData={labels:[],datasets:[{data:[],label:"Turnos Solicitados Por Fecha"}]},this.barChartOptions={responsive:!1},this.display=!1}ngOnInit(){this.reportService.ReportsSubscription().subscribe(()=>{let i,e=this.reportService.GetGroupedAppointmentsByDate(),a=[];for(i in e){let s={};s[i]=e,a.push(s)}a.sort((s,m)=>{let d=[],l=[];for(i in s)d=i.split("/");for(i in m)l=i.split("/");if(d?.length>=3&&l?.length>=3){let u=new Date(Number(d[2]),Number(d[1]),Number(d[0])),O=new Date(Number(l[2]),Number(l[1]),Number(l[0]));return u.getTime()-O.getTime()}return 0}),a.forEach(s=>{for(i in s)this.barChartData.labels?.push(i),this.barChartData.datasets[0].data.push(s[i][i])}),this.display=!0}),this.reportService.ready&&this.reportService.ReportsAreReady()}GetBase64FromCanvas(e){const i=e.toDataURL();c.createPdf({content:[{image:"data:image/jpg;base64,"+v.N.clinicLogo,width:200,height:200,alignment:"center"},{text:"Reporte de turnos por fecha",fontSize:22,bold:!0,alignment:"center"},{image:i,width:400,height:400,alignment:"center",margin:[0,50]}]}).open()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-bar-chart"]],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["baseChart","",2,"width","840px","height","840px",3,"data","options","plugins","legend","type"],["canvas",""],[1,"btn","btn-primary",3,"click"]],template:function(e,i){1&e&&t.YNc(0,N,5,5,"div",0),2&e&&t.Q6J("ngIf",i.display)},dependencies:[h.O5,f.jh]}),n})();c.vfs=y.I.vfs;let I=(()=>{class n{constructor(e){this.reportService=e,this.lineChartData={labels:["January","February","March","April","May","June","July"],datasets:[{data:[65,59,80,81,56,55,40],label:"Series A",fill:!0,tension:.5,borderColor:"black",backgroundColor:"rgba(255,0,0,0.3)"}]},this.lineChartOptions={responsive:!1},this.lineChartLegend=!0}ngOnInit(){this.reportService.ready&&this.reportService.ReportsAreReady()}GetBase64FromCanvas(e){const a={content:[{image:e.toDataURL(),width:250,height:250,alignment:"center"}]};c.createPdf(a).open()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-linear-graph"]],decls:3,vars:4,consts:[[1,"container"],["baseChart","","width","1200px","height","900px",3,"type","data","options","legend"],["canvas",""]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"canvas",1,2),t.qZA()),2&e&&(t.xp6(1),t.Q6J("type","line")("data",i.lineChartData)("options",i.lineChartOptions)("legend",i.lineChartLegend))},dependencies:[f.jh]}),n})();var b=r(574),Z=r(2963);function U(n,o){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA()()),2&n){const e=o.$implicit,i=t.oxw();t.xp6(2),t.hij(" ",i.reportService.GetSpecialistFullNameByUid(e.uid)," "),t.xp6(2),t.hij(" ",i.dateService.getLocaleDateStringByTimestamp(e.timestamp)," "),t.xp6(2),t.hij(" ",i.dateService.getLocaleTimeStringByTimestamp(e.timestamp)," ")}}let w=(()=>{class n{constructor(e,i){this.reportService=e,this.dateService=i,this.loginLogs=[]}ngOnInit(){this.reportService.GetLoginLogs().subscribe(e=>{this.loginLogs=e,console.dir(e)})}exportAsExcel(e){const i=b.P6.table_to_sheet(e),a=b.P6.book_new();b.P6.book_append_sheet(a,i,"Sheet1"),b.NC(a,"logins.xlsx")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g),t.Y36(Z.R))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-login-logs-table"]],decls:14,vars:1,consts:[[1,"container"],[1,"table","striped-table","mt-4"],["table",""],[4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"click"]],template:function(e,i){if(1&e){const a=t.EpF();t.TgZ(0,"div",0)(1,"table",1,2)(3,"thead")(4,"th"),t._uU(5,"Usuario"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"Fecha"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Hora"),t.qZA()(),t.TgZ(10,"tbody"),t.YNc(11,U,7,3,"tr",3),t.qZA()(),t.TgZ(12,"button",4),t.NdJ("click",function(){t.CHM(a);const m=t.MAs(2);return t.KtG(i.exportAsExcel(m))}),t._uU(13,"Descargar"),t.qZA()()}2&e&&(t.xp6(11),t.Q6J("ngForOf",i.loginLogs))},dependencies:[h.sg]}),n})();function P(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",1),t._UZ(1,"canvas",2,3),t.TgZ(3,"button",4),t.NdJ("click",function(){t.CHM(e);const a=t.MAs(2),s=t.oxw();return t.KtG(s.GetBase64FromCanvas(a))}),t._uU(4,"Descargar"),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("type","pie")("datasets",e.pieChartDatasets)("labels",e.pieChartLabels)("options",e.pieChartOptions)("plugins",e.pieChartPlugins)("legend",e.pieChartLegend)}}c.vfs=y.I.vfs;const J=[{path:"",children:[{path:"linear-graph",component:I},{path:"pie-chart",component:(()=>{class n{constructor(e){this.reportService=e,this.pieChartOptions={responsive:!1},this.pieChartLabels=[],this.pieChartDatasets=[{data:[]}],this.pieChartLegend=!0,this.pieChartPlugins=[],this.display=!1}ngOnInit(){this.reportService.ReportsSubscription().subscribe(()=>{this.reportService.GetAppointmentsBySpecialityAsLabeledData().forEach(i=>{this.pieChartLabels.push(i.label),this.pieChartDatasets[0].data.push(i.data)}),this.display=!0}),this.reportService.ready&&this.reportService.ReportsAreReady()}GetBase64FromCanvas(e){const i=e.toDataURL();c.createPdf({content:[{image:"data:image/jpg;base64,"+v.N.clinicLogo,width:200,height:200,alignment:"center"},{text:"Reporte de turnos por especialidad",fontSize:22,bold:!0,alignment:"center"},{image:i,width:400,height:400,alignment:"center",margin:[0,50]}]}).open()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-pie-chart"]],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["baseChart","",2,"width","750px","height","750px",3,"type","datasets","labels","options","plugins","legend"],["canvas",""],[1,"btn","btn-primary",3,"click"]],template:function(e,i){1&e&&t.YNc(0,P,5,6,"div",0),2&e&&t.Q6J("ngIf",i.display)},dependencies:[h.O5,f.jh]}),n})()},{path:"bar-chart",component:F},{path:"appointments-by-specialist",component:G},{path:"login-logs",component:w}]}];let k=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[S.Bz.forChild(J),S.Bz]}),n})(),M=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.ez,k,f.vQ,p.UX]}),n})()}}]);